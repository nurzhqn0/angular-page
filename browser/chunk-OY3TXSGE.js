import{$ as d,c as u,j as a,m as g,r as n}from"./chunk-T4YJC36P.js";var c=class i{constructor(){}setItem(e,t){try{let r=JSON.stringify(t);localStorage.setItem(e,r)}catch(r){console.error("Error storing data in localStorage:",r)}}getItem(e){try{let t=localStorage.getItem(e);return t===null?null:JSON.parse(t)}catch(t){return console.error("Error retrieving data from localStorage:",t),null}}removeItem(e){try{localStorage.removeItem(e)}catch(t){console.error("Error removing data from localStorage:",t)}}clear(){try{localStorage.clear()}catch(e){console.error("Error clearing localStorage:",e)}}hasItem(e){return localStorage.getItem(e)!==null}getAllKeys(){let e=[];for(let t=0;t<localStorage.length;t++){let r=localStorage.key(t);r&&e.push(r)}return e}static \u0275fac=function(t){return new(t||i)};static \u0275prov=a({token:i,factory:i.\u0275fac,providedIn:"root"})};var S=class i{constructor(e,t){this.router=e;this.storageService=t;this.initializeAuth()}AUTH_KEY="auth_user";USERS_KEY="registered_users";currentUser=n(null);isAuthenticated=n(!1);isLoading=n(!1);get user(){return this.currentUser.asReadonly()}get authenticated(){return this.isAuthenticated.asReadonly()}get loading(){return this.isLoading.asReadonly()}initializeAuth(){let e=this.storageService.getItem(this.AUTH_KEY);e&&e.user&&(this.currentUser.set(e.user),this.isAuthenticated.set(!0))}login(e){return this.isLoading.set(!0),new u(t=>{setTimeout(()=>{let o=(this.storageService.getItem(this.USERS_KEY)||[]).find(s=>s.user.email===e.email&&s.password===e.password);if(o){this.currentUser.set(o.user),this.isAuthenticated.set(!0),this.storageService.setItem(this.AUTH_KEY,o);let s={success:!0,message:"Login successful",user:o.user,token:o.token};this.isLoading.set(!1),t.next(s),t.complete()}else{let s={success:!1,message:"Invalid email or password"};this.isLoading.set(!1),t.next(s),t.complete()}},1e3)})}register(e){return this.isLoading.set(!0),new u(t=>{setTimeout(()=>{let r=this.storageService.getItem(this.USERS_KEY)||[];if(r.find(l=>l.user.email===e.email)){let l={success:!1,message:"User with this email already exists"};this.isLoading.set(!1),t.next(l),t.complete();return}let s={id:this.generateId(),email:e.email,firstName:e.firstName,lastName:e.lastName,role:"user",createdAt:new Date().toISOString()},h=this.generateToken(),m={user:s,token:h,password:e.password};r.push(m),this.storageService.setItem(this.USERS_KEY,r),this.currentUser.set(s),this.isAuthenticated.set(!0),this.storageService.setItem(this.AUTH_KEY,m);let p={success:!0,message:"Registration successful",user:s,token:h};this.isLoading.set(!1),t.next(p),t.complete()},1500)})}logout(){this.currentUser.set(null),this.isAuthenticated.set(!1),this.storageService.removeItem(this.AUTH_KEY),this.router.navigate(["/auth/login"])}isLoggedIn(){return this.isAuthenticated()}getCurrentUser(){return this.currentUser()}clearAllAuthData(){this.storageService.removeItem(this.AUTH_KEY),this.storageService.removeItem(this.USERS_KEY),this.currentUser.set(null),this.isAuthenticated.set(!1)}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}generateToken(){return"token_"+Date.now().toString(36)+Math.random().toString(36).substr(2)}static \u0275fac=function(t){return new(t||i)(g(d),g(c))};static \u0275prov=a({token:i,factory:i.\u0275fac,providedIn:"root"})};export{S as a};
